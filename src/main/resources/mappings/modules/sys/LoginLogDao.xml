<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.sys.dao.LoginLogDao">

    <select id="queryLoginLogList" parameterType="java.util.Map"
            resultType="com.thinkgem.jeesite.modules.sys.entity.LoginLog">
        SELECT COUNT(*) AS COUNT, ll.company_id AS companyId,ll.office_id AS officeId,ll.login_name AS loginName,ll.user_name AS userName
        FROM sys_login_log ll
        WHERE 1 = 1
        <if test="loginNames!=null">
            and ll.login_name in (${loginNames})
        </if>
        <if test="officeIds!=null">
            and ll.office_id in (${officeIds})
        </if>
        <if test="name!=null">
            and ll.name = #{name}
        </if>
        <if test="loginName!=null">
            and ll.login_name = #{loginName}
        </if>
        <if test="officeCode!=null">
            and ll.office_code like '${officeCode}%'
        </if>
        <if test="companyId!=null">
            and ll.company_id = #{companyId}
        </if>
        <if test="startTime!=null">
            and ll.create_date &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and ll.create_date &lt; #{endTime}
        </if>
        GROUP BY ll.office_id,ll.login_name
        <if test="listStart!=null and pageSize!=null">
            LIMIT #{listStart}, #{pageSize}
        </if>
    </select>

    <insert id="save" parameterType="com.thinkgem.jeesite.modules.sys.entity.LoginLog">
        insert into sys_login_log(office_id,office_name,company_id,company_name,user_name,login_name,type,client_type,year,month,day,week,create_date)
        values (#{officeId},#{officeName},#{companyId},#{companyName},#{userName},#{loginName},#{type},#{clientType},#{year},#{month},#{day},#{week},#{createDate})
    </insert>

    <select id="listCount" parameterType="java.util.Map" resultType="java.lang.Integer">
        select count(*) from
        (
        SELECT ll.id
        FROM sys_login_log ll
        WHERE 1 = 1
        <if test="loginNames!=null">
            and ll.login_name in (${loginNames})
        </if>
        <if test="officeIds!=null">
            and ll.office_id in (${officeIds})
        </if>
        <if test="userName!=null">
            and ll.user_name = #{userName}
        </if>
        <if test="loginName!=null">
            and ll.login_name = #{loginName}
        </if>
        <if test="officeCode!=null and officeCode!='100000'">
            and ll.office_code like '${officeCode}%'
        </if>
        <if test="companyId!=null">
            and ll.company_id = #{companyId}
        </if>
        <if test="startTime!=null">
            and ll.create_date &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and ll.create_date &lt; #{endTime}
        </if>
        GROUP BY ll.office_id,ll.login_name
        ) as temp
    </select>

    <select id="queryLoginLogByMonth" parameterType="java.util.Map"
            resultType="com.thinkgem.jeesite.modules.sys.entity.LoginLog">
        SELECT COUNT(*) AS COUNT, ll.company_id AS companyId,ll.office_id AS officeId,ll.office_code AS officeCode,
        ll.login_name AS loginName,ll.user_name AS NAME,ll.month as month,ll.year as year
        FROM sys_login_log ll
        <if test="month!=null">
            WHERE ll.month = #{month}
        </if>
        <if test="year!=null">
            WHERE ll.year = #{year}
        </if>
        GROUP BY ll.office_id,ll.login_name
    </select>

</mapper>